# Piggy Wallet

## Project Description
Piggy Wallet is an innovative application that leverages blockchain technology to help families save and provide financial education to their children in economies affected by high inflation. Our platform offers a safe, intuitive, and accessible experience for both parents and children, allowing them to manage savings effectively and teach healthy financial habits from an early age.

## Focused Challenges

- **Inflation protection:** Provide a solution that helps families protect their savings from the devaluation of local currency.
- **Early financial education:** Facilitate children's financial learning in a practical and age-appropriate way.
- **Technological accessibility:** Remove technical barriers associated with cryptocurrencies and blockchain technology by offering a simple and user-friendly interface.
- **Cross-chain transactions:** Implement a system that allows operations across multiple blockchains efficiently and securely.
- **Data persistence and security:** Integrate a robust database that ensures the integrity and availability of user information.


## Developed Features

1. **Registration and Authentication with Privy**
- **Automatic Wallet Generation:** Upon registration with an email address, users are automatically provided with a wallet generated by Privy, eliminating the complexity of creating and managing cryptocurrency wallets.
- **Smart Account Generation:** These accounts allow users to manage their wallets through smart contracts instead of directly interacting with the blockchain. Smart Accounts enable advanced automations and permissions, improving user experience. Privy facilitates the management and generation of these smart accounts.
- **Integration with Safe:** Safe ensures that all transactions within the smart account follow a secure and predefined structure. This includes multi-signature verification to validate critical transactions, providing a higher level of security for wallets automatically generated by Privy.
- **Enhanced Security:** By using Privy, we ensure that access credentials and private keys are protected under high-level security standards.
- **Custom User Flow:**
    - **New Users:** If the user is new, the system creates their profile and redirects them to the settings to add information about their children.
    - **Existing Users:** If the user already has an account, their wallets are updated and a dynamic dashboard with up-to-date information is displayed.

2. **Cross-Chain Transactions with Multi-Chain Support**
- **Implementation of Deposits on Multiple Chains:** We have developed methods to execute cross-chain transactions, allowing users to deposit funds from various blockchain networks such as Ethereum Sepolia, Optimism, Arbitrum, Polygon zkEVM, Avalanche Fuji, and Base Sepolia.
- **Use of USDC and Circle's CCTP:** We use USD Coin (USDC) and Circle's Cross-Chain Transfer Protocol (CCTP) to facilitate stable and reliable value transfers between different chains.
- **Custom Code for Transaction Management:**
    - **Swapper Component:** We developed a React component that allows users to select the source network, input the amount to transfer, and manage the entire cross-chain transfer process.
    - **Interaction with Smart Contracts:** The code interacts with smart contracts such as `TokenMessenger` and `MessageTransmitter` to burn tokens on the source chain and mint tokens on the destination chain.
    - **Event and Log Management:** We implemented logic to extract and process blockchain events necessary to validate and complete transactions.
- **Error Handling and Network Switching:**
    - **Automatic Network Switching in Metamask:** The system prompts the user to switch networks in Metamask as needed to complete the cross-chain transaction.
    - **Exception Management:** Mechanisms were implemented to handle common errors, such as the network being unavailable in Metamask, offering alternative solutions like automatically adding the network.
- **Testing Transactions on Base Sepolia Test Network:** Below are links to some transaction examples carried out during the development process to test the use of the Base network for depositing USDC tokens into the smart account. These transactions are deposits made from the app.
    - **Links:** 
        - https://sepolia.basescan.org/tx/0x75aa511f71c16300c29d8a13b205e47e72fbf575c3ddc00b736bce0e729cdc8d
        - https://sepolia.basescan.org/tx/0xb03fad7fdb71b9383d8f0ae3b707ae4129192ca59327ecab371cbd5d51c3440e


3. **Integration of Relational Database with PostgreSQL and Sequelize**
- **Migration from Hardcoded Data:** Previously, the application had no data persistence and used static information. We implemented a relational database to improve scalability and functionality.
- **Normalized Data Models:**
    - **User:** Stores basic information such as email and wallet address. If the user does not register an email, only the wallet address is stored.
    - **Child:** Model representing the user's children, allowing the management of individual profiles and savings goals.
    - **UserWallet:** Relates users to their different wallets, allowing management of multiple accounts or assets.
    - **UserKYC:** Prepared to integrate identity verification processes when we implement the on-ramp with Manteca.
- **Improved CRUD Functions:** Developed functions to create, read, update, and delete records in the database, ensuring data integrity and consistency.

4. **Preparation for Integration with Manteca (On-Ramp)**
- **Research and Planning:** We conducted a detailed analysis on how to integrate Manteca, a service that enables fund deposits from MercadoPago directly to the blockchain. We met with Manteca's founder, who explained the process in detail so we can connect to their platform.
- **Identified Benefits:**
    - **Facilitate Cryptocurrency Acquisition:** Allow users to purchase cryptocurrencies using local and familiar payment methods.
    - **Expand Service Access:** Reduce entry barriers for users unfamiliar with exchanges or complex purchasing processes.
- **Links and Resources:**
    - **Manteca Documentation:** We include references and links to the official documentation to facilitate future implementations.

5. **Dynamic and Personalized Dashboard**
- **Real-Time Information Display:**
    - **Updated Balances:** Show the current balance of the user's wallets, including conversions to Argentine pesos for easier understanding.
    - **Savings Goals:** Allow the creation and tracking of specific financial goals for each child.
- **Intuitive Interface:** Designed a user-friendly UI, easy to navigate for both adults and children.
- **Enhanced User Experience:** Implemented features that respond to user behavior and needs, such as notifications and reminders.

6. **Additional Features and Improvements**
- **Login Validation and Redirection:**
    - **User Existence Verification:** When logging in, the system checks if the user already exists in the database.
    - **Smart Redirection:** New users are redirected to the initial setup process (adding children), while existing users are directed straight to the dashboard.
- **Balance Reading and Conversion:**
    - **Monitoring Wallet Funds:** We implemented functions to read the balance of funds in the users' wallets.
    - **Conversion to Local Currency:** Display the equivalent in Argentine pesos, making it easier to understand the real value of savings.

7. **Support and Scalability**
- **Modular Architecture:** The code is structured in a modular way, making it easy to add new features and maintain.
- **Prepared for Scaling:** The implementation of a relational database and the use of an ORM allow for horizontal scalability as the user base grows.
- **Security and Compliance:** While not fully implemented yet, plans are in place to integrate KYC processes and regulatory compliance to ensure security and trust in the service.

## Innovations in This Hackathon
- **Improved Data Persistence:** The integration of a relational database represented a significant advancement over previous versions, enabling more robust and efficient data management.
- **Advanced Cross-Chain Transactions:** Support for multiple chains and the implementation of cross-chain transactions with Circle's CCTP is an innovation that broadens the service's usage and accessibility.
- **Focus on User Experience:** Significant improvements were made to the user flow and interface, prioritizing usability and simplifying complex processes.
- **Preparation for Local On-Ramp:** The research and planning to integrate Manteca demonstrate our commitment to adapting to the local context and facilitating access to blockchain technology.

## Technologies Used

### Fullstack:
- **Next.js:** React framework that enables server-side rendering and static site generation.
- **React Hooks and Context API:** For efficient state management and shared logic.
- **Sequelize ORM:** Tool for interacting with the PostgreSQL database in an efficient and secure manner.

### Database:
- **PostgreSQL:** Open-source relational database management system.

### Blockchain and Cryptocurrencies:
- **Ethereum and Test Networks:** Use of Ethereum Sepolia, Optimism, Arbitrum, Polygon zkEVM, Avalanche Fuji, and Base Sepolia.
- **Ethers.js:** Library for interacting with the Ethereum blockchain.
- **USDC and Circle's CCTP:** To facilitate stable and cross-chain transactions.

### Authentication and Security:
- **Privy:** Platform for managing identities and wallets securely.

### Additional Tools and Services:
- **Manteca:** Planned service for integrating on-ramp from MercadoPago.
- **Metamask:** Browser extension for interacting with wallets and blockchain networks.
- **Circle API (Iris API):** Used to obtain attestations and validate cross-chain transactions.

## Important Links
- **GitHub Repository:** https://github.com/Rocking-Product/piggy-wallet
- **Live Demo:** https://piggy-deploy.vercel.app/Dashboard
- **Manteca Documentation:** https://www.manteca.dev

## User Feedback

Emilio is 42 years old, with two children aged 9 and 6. He works in technology and has been investing since he was young, although he always felt he would have liked to receive more financial education. Like many parents in Argentina, Emilio is concerned about constant inflation and is looking for ways to teach his children the value of money and how to manage it from a young age.

From the conversation with Emilio, we highlighted the following:

*When they were younger, I used to give them money from time to time, but now I want them to understand that money doesn't just appear out of nowhere, you have to earn it. So now they help us with household chores. With the app, they can see that they need to complete tasks at home to receive rewards. It’s a very practical way for them to learn that effort has value.*

*In an economy like ours, where the currency loses value quickly, I think it's essential for them to understand from a young age that there are ways to protect it and make it go further. The app makes it simple and visual, which I think is essential. It would be ideal if it were like a game, similar to Duolingo, which makes learning a language more fun. I imagine something like that. I find it very appealing, and it would be something I’d use the app for, if it helps my children learn about money, savings, and investments.*

*As for why I’d use the app, several things. Mainly for the learning aspect, if I can make household chores more entertaining and give them more motivation to do them while at the same time teaching them about the value of money and work. Then showing them that if they don’t spend it and save it, they can buy other things they want, and help them develop the habit of saving. And if I later show them that if they invest that money, they can watch it grow. Then, I can imagine an animation showing the growth, like a plant growing and bearing fruit, or something like that.*

*What I think would be a great plus is also using it as a virtual wallet, being able to give them money and control their spending. I could give them autonomy so they can manage it and even make mistakes. Or let them choose to invest it as we’ve discussed. If the app also included courses or guides on how to invest, in a didactic way or with animated videos, that would be fantastic.*

## How to Run the Project
**Clone the repository:**

`git clone https://github.com/Rocking-Product/piggy-wallet.git`

**Install dependencies:**

`npm install`

**Configure environment variables:**

- Create a .env file at the root of the project. 
- Add the necessary variables following the format of the .env.example file. 
- Key variables: 
    - `DATABASE_URL`: PostgreSQL database connection URL. 
    - `NEXT_PUBLIC_PRIVY_APP_ID`: Privy API key. 
    - `CIRCLE_API_KEY`: Circle API key for CCTP. 
    - `NEXT_PUBLIC_PIMLICO_API_KEY`: PIMLICO API key.

**Start the application in development mode:**

- npm run dev Access the application: Open a web browser and navigate to `http://localhost:3000`
